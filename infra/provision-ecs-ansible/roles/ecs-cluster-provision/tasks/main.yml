---
# update Shippable resource state with this job number
- name: run cmd
  shell: |
    shipctl post_resource_state "{{ STATE_RES_NAME }}" versionName "build-${BUILD_NUMBER}"

# provision ECS cluster
- name: Create ECS Cluster {{ ECS_CLUSTER_NAME }}
  ecs_cluster:
    name: "{{ ECS_CLUSTER_NAME }}"
    state: present
  register: ecs

# update shippable resource state with provisioned cluster_arn
- name: run cmd
  shell: |
    shipctl put_resource_state "{{ STATE_RES_NAME }}" "CLUSTER_NAME" "{{ ECS_CLUSTER_NAME }}"
    shipctl put_resource_state "{{ STATE_RES_NAME }}" "REGION" "{{ ec2_region }}"
    shipctl put_resource_state "{{ STATE_RES_NAME }}" "CLUSTER_ARN" "{{ ecs.cluster.clusterArn }}"
    shipctl put_resource_state "{{ CLUSTER_RES_NAME }}" "region" "{{ ec2_region }}"
    shipctl put_resource_state "{{ CLUSTER_RES_NAME }}" "sourceName" "{{ ECS_CLUSTER_NAME }}"
